#+TITLE: Система тестирования vlisp
#+AUTHOR: Mykola Matvyeyev
#+DATE: <2025-12-23 Пн>

* Система тестирования vlisp

Создана полнофункциональная система unit-тестирования на базе *FiveAM*.

** Структура

#+BEGIN_EXAMPLE
vlisp/
├── tests/
│   ├── package.lisp          # Определение пакета и основного набора
│   ├── utils.lisp            # Вспомогательные функции сравнения
│   ├── vector-tests.lisp     # Тесты векторных операций (23 теста)
│   └── geometric-tests.lisp  # Тесты геометрических функций (21 тест)
├── vlisp-tests.asd           # Отдельная ASDF система для тестов
├── run-tests.lisp            # Скрипт для запуска из командной строки
└── vlisp.asd                 # Основная система (без тестов)
#+END_EXAMPLE

** Запуск тестов

Тесты теперь оформлены как отдельная ASDF система *vlisp-tests*.

*** Из REPL
#+BEGIN_SRC lisp
(asdf:test-system "vlisp-tests")
;; или
(asdf:load-system "vlisp-tests")
(vlisp/tests:run-tests)
#+END_SRC

*** Из командной строки
#+BEGIN_SRC bash
sbcl --non-interactive \
     --eval "(require :asdf)" \
     --eval "(asdf:test-system \"vlisp-tests\")"
#+END_SRC

** Результаты

✅ *57 тестов, 100% успешных*

*** Векторные операции (23 теста)
- ~vector-length~ - длина вектора
- ~vector+~ - сложение векторов
- ~vector-~ - вычитание векторов
- ~normalize~ - нормализация вектора
- ~mid-point~ - середина отрезка
- ~vector-dot-product~ - скалярное произведение
- ~vector-cross-product~ - векторное произведение

*** Геометрические функции (21 тест)
- ~angle~ - угол между точками
- ~distance~ - расстояние между точками
- ~polar~ - точка по углу и расстоянию
- ~inters~ - пересечение линий

** Особенности

- Все тесты используют ~approx-equal~ для сравнения чисел с плавающей точкой
- Точность настраивается через параметр ~epsilon~ (по умолчанию 1d-9)
- Модульная структура - легко добавлять новые тесты
- Интеграция с ASDF для автоматизации

** Следующие шаги

Можно добавить тесты для:
- Функций работы с selection sets (когда будет реализация)
- Функций из модуля ~dr~ (отрисовка)
- Функций из модуля ~axis~ (оси координат)
